{% extends "base_dash.html" %}
{% load crispy_forms_tags %}
{% block titre_page %}{{ object }}{% endblock %}
{% load static %}

{% block entete_dash %}
<header class="page-header page-header-compact page-header-light border-bottom bg-white mb-4">
    <div class="container-fluid px-4">
        <div class="page-header-content">
            <div class="row align-items-center justify-content-between pt-3">
                <div class="col-auto mb-3">
                    <h1 class="page-header-title">
                        <div class="page-header-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-globe"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg></div>
                        Details de la localisation
                    </h1>
                </div>
                <div class="col-12 col-xl-auto mb-3">
                    <a class="btn btn-sm btn-light text-primary" href="{% url 'catalogue:localisation-modif' pk=object.pk %}">
                    <i class="far fa-edit"></i>  Editer
                    </a>
                </div>
            </div>
        </div>
    </div>
</header>
{% endblock %}

{% block contenu_dash %}
<div class="container-fluid px-4">
    <div class="card bg-gradient-primary-to-secondary mb-4">
        <div class="card-body">
            <div class="d-flex align-items-center justify-content-between">
                <div class="me-3">
                    <div class="small text-white-50"></div>
                    <div class="h1 text-white">{{ object }}</div>
                </div>
            </div>
        </div>
    </div>

<div class="row">
    <div class="col-xxl-4 col-xl-12 mb-4">
        <div class="card card-header-actions h-100">
            <div class="card-header">
                GÃ©olocalisation
            </div>
            <div class="card-body">
                <div id="map" style="height:200px;"></div>
            </div>
        </div>
    </div>
    <div class="col-xxl-4 col-xl-6 mb-4">
        <div class="card card-header-actions h-100">
            <div class="card-header">
                Occupants
            </div>
            <div class="card-body">
                <ul class="list-unstyled">
                {% for occupant in occupants %}
                        {% for org in occupant.of_organization.all %}
                            <li><a href="{{ org.get_absolute_url }}">{{ org }}</a></li>
                        {% endfor %}
                {% endfor %}            
                </ul>
            </div>
        </div>
    </div>
    <div class="col-xxl-4 col-xl-6 mb-4">
        <div class="card card-header-actions h-100">
            <div class="card-header">
                Parcelles cadastrales
            </div>
            <div class="card-body">

            </div>
            <div class="card-footer position-relative">
                <div class="d-flex align-items-center justify-content-between small text-body">
                </div>
            </div>
        </div>
    </div>
</div>

</div>
{% endblock %}


{% block js_page %}
{% load l10n %}
<script type="text/javascript">
  var map = L.map('map').setView([{{object.latitude|unlocalize}}, {{object.longitude|unlocalize}}], 18);

  var osm = L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 22,
  }).addTo(map);

  var info_best = L.tileLayer.wms('http://wms.ngi.be/inspire/best/service?', {
    layers:"itgi_best_complet_view_simple_names",
    format:"image/png",
    maxZoom: 22,
  });

  var info_minfin = L.tileLayer.wms('http://ccff02.minfin.fgov.be/geoservices/arcgis/services/WMS/Cadastral_Layers/MapServer/WMSServer',{
    layers: 'Cadastral building,Cadastral Parcel,Regional building',
    format:'image/png',
    maxZoom: 22,
  });

  var baseMaps = {
    "Osm":osm,
    "BeST":info_best,
    "Cadastre":info_minfin,
  };

  L.marker([{{ object.latitude|unlocalize }}, {{ object.longitude|unlocalize }}]).addTo(map).bindPopup('{{ object }}');
  L.control.layers(baseMaps,null,{
    position:'topleft'
  }).addTo(map);
  map.addControl(new L.Control.Fullscreen());
  L.control.scale().addTo(map);
</script>
{% endblock %}
